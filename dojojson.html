<!doctype html>
<html>
    <head>
        <meta charset="utf-8">
        <title>Weather Web App</title>
        <!-- <link href='//fonts.googleapis.com/css?family=Merriweather+Sans' rel='stylesheet' type='text/css'> -->
        <script src="http://js.arcgis.com/3.9/"></script>
        
<script>    require(["dojo/Deferred", "esri/request", "dojo/_base/array", "dojo/dom-construct", "dojo/dom", "dojo/domReady!"],
        function(Deferred, request, arrayUtil, domConstruct, dom) {
     
            // Create a deferred and get the user list
            var deferred = new Deferred(),
                userlist = dom.byId("userlist");
     
            // Set up the callback and errback for the deferred
            deferred.then(function(res){
                arrayUtil.forEach(res, function(user){
                    domConstruct.create("li", {
                        id: user.id,
                        innerHTML: user.username + ": " + user.name
                    }, userlist);
                });
            },function(err){
                domConstruct.create("li", {
                    innerHTML: "Error: " + err
                }, userlist);
            });

            // var theFetch = request.get("http://api.openweathermap.org/data/2.5/weather?lat=53.287&lon=-6.17&units=metric", { handleAs: "json"})
            // console.log(theFetch);

          var theFetch = request({
          url: "http://api.openweathermap.org/data/2.5/weather?",
          content:{
          lat:"53.287",
          lon: "-6.17",
          units: "metric"
          // tags: dom.byId("inputSearchTags").value
          // this retreives user input
          //tags: "baby" // param to search for
          },
          callbackParamName: "callback" // if this missing, it breaks
          });
          theFetch.then(addPhotos);

            function addPhotos(data){
            console.log("please work"+data.name);
            }

            // Send an HTTP request
            request.get("http://api.openweathermap.org/data/2.5/weather?lat=53.287&lon=-6.17&units=metric", {
                handleAs: "json"}).then(
                function(response){
                    // Resolve when content is received
                    deferred.resolve(response);
                },
                function(error){
                    // Reject on error
                    deferred.reject(error);
                }
            );
    });
</script>
</head>
<body></body>
</html>